{"version":3,"sources":["scripts/dev/View/BasketItemCollection.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;QAOM,oBAAoB;iBAApB,oBAAoB;kCAApB,oBAAoB;;uCAApB,oBAAoB;;;kBAApB,oBAAoB;;qBAApB,oBAAoB;;;;mBAEf,mBAAG;AACN,uBAAO,IAAI,CAAC;aACf;;;mBAES,oBAAC,OAAO,EAAE;AAChB,oBAAI,CAAC,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC;;AAE7B,oBAAI,CAAC,aAAa,GAAG,IAAI,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC;AAC3C,0BAAM,EAAE,IAAI,CAAC,MAAM,CAAC,EAAE;AACtB,2BAAO,EAAE,8BAAkB,OAAO,EAAE;iBACvC,EAAE,OAAO,CAAC,CAAC;;AAEZ,oBAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE,OAAO,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;AAChE,oBAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;AAClD,oBAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE,WAAW,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;AAC7D,oBAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE,aAAa,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;AACjE,oBAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,EAAE,WAAW,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;;AAEhE,oBAAI,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;aAChC;;;mBAEW,sBAAC,UAAU,EAAE;AACrB,sCACK,gBAAgB,CAAC,cAAE,KAAK,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC,CAChD,IAAI,CAAC,qBAAS,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,iBAAiB,EAAE,IAAI,CAAC,CAAC,CAAC;aAC7D;;;mBAES,oBAAC,UAAU,EAAE;AACnB,sCACK,cAAc,CAAC,cAAE,KAAK,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC,CAC9C,IAAI,CAAC,qBAAS,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,iBAAiB,EAAE,IAAI,CAAC,CAAC,CAAC;aAC7D;;;mBAEgB,2BAAC,UAAU,EAAE;AAC1B,oBAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC;aAClD;;;mBAEI,eAAC,UAAU,EAAE;AACd,oBAAI,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;aAC/B;;;mBAEgB,2BAAC,UAAU,EAAE;AAC1B,oBAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC;AACjB,oBAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;aAC3B;;;mBAEK,gBAAC,UAAU,EAAE;AACf,oBAAI,CAAC,UAAU,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;;;;;;;AAEpC,yCAAsB,UAAU,CAAC,MAAM,8HAAE;4BAAjC,UAAU;;AACd,4BAAI,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;qBAC/B;;;;;;;;;;;;;;;aACJ;;;mBAES,oBAAC,UAAU,EAAE;AACnB,oBAAI,CAAC,GAAG,CAAC,MAAM,CAAC,+BAAoB,EAAC,KAAK,EAAE,UAAU,EAAC,CAAC,CAAE,GAAG,CAAC,CAAC;aAClE;;;eA1DC,oBAAoB;OAAS,qBAAS,IAAI;;qBA6DjC,oBAAoB","file":"scripts/dev/View/BasketItemCollection.js","sourcesContent":["import Backbone from 'libs/backbone'\nimport BasketItemView from './BasketItem'\nimport BasketItemCollectionModel from 'Model/BasketItemCollection'\nimport productCollection from 'Model/ProductCollection'\nimport _ from 'underscore'\nimport rpcClient from 'Service/JsonRpcClient'\n\nclass BasketItemCollection extends Backbone.View {\n    //noinspection JSMethodCanBeStatic\n    tagName() {\n        return 'ul';\n    }\n\n    initialize(options) {\n        this.basket = options.basket;\n\n        this.newBasketItem = new this.collection.model({\n            basket: this.basket.id,\n            product: productCollection.firstId()\n        }, options);\n\n        this.listenTo(this.collection, 'reset', this.onCollectionReset);\n        this.listenTo(this.collection, 'add', this.onAdd);\n        this.listenTo(this.collection, 'save-item', this.onSaveItem);\n        this.listenTo(this.collection, 'delete-item', this.onDeleteItem);\n        this.listenTo(this.newBasketItem, 'save-item', this.onSaveItem);\n\n        this.render(this.collection);\n    }\n\n    onDeleteItem(basketItem) {\n        rpcClient\n            .deleteBasketItem(_.clone(basketItem.attributes))\n            .then(Backbone.$.proxy(this.onBasketItemSaved, this));\n    }\n\n    onSaveItem(basketItem) {\n        rpcClient\n            .saveBasketItem(_.clone(basketItem.attributes))\n            .then(Backbone.$.proxy(this.onBasketItemSaved, this));\n    }\n\n    onBasketItemSaved(basketData) {\n        this.basket.set(this.basket.parse(basketData));\n    }\n\n    onAdd(basketItem) {\n        this.renderItem(basketItem);\n    }\n\n    onCollectionReset(collection) {\n        this.$el.empty();\n        this.render(collection);\n    }\n\n    render(collection) {\n        this.renderItem(this.newBasketItem);\n\n        for(let basketItem of collection.models) {\n            this.renderItem(basketItem);\n        }\n    }\n\n    renderItem(basketItem) {\n        this.$el.append((new BasketItemView({model: basketItem})).$el);\n    }\n}\n\nexport default BasketItemCollection;"]}